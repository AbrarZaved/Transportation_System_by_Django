<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}DIU Transportation Admin{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    {% block style %}
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
    {% endblock style %}
  </head>
  <body class="bg-gray-100 text-slate-800">
    <div class="flex min-h-screen" x-data="{ sidebarOpen: false }" x-cloak>
      <aside
        class="fixed inset-y-0 left-0 z-30 w-64 bg-slate-900 text-white transform transition-transform duration-300 ease-in-out lg:relative lg:translate-x-0 lg:flex lg:flex-col lg:w-64"
        :class="{ '-translate-x-full': !sidebarOpen, 'translate-x-0': sidebarOpen }"
      >
        <div
          class="flex items-center justify-between px-4 py-5 lg:justify-center"
        >
          <div class="text-xl font-bold text-emerald-400">üöç DIU Admin</div>
          <button class="lg:hidden text-white" @click="sidebarOpen = false">
            ‚úï
          </button>
        </div>

        <nav class="flex flex-col px-4 space-y-2 text-sm">
          <!-- Dashboard -->
          <div
            class="font-semibold text-gray-400 uppercase px-2 mt-2 mb-1 text-xs"
          >
            Dashboard
          </div>
          <a
            href="{% url 'dashboard' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path d="M2 10a8 8 0 018-8v8h8a8 8 0 01-8 8v-8z" />
              <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" />
            </svg>
            Dashboard
          </a>

          <!-- Schedules & Buses -->
          <div
            class="font-semibold text-gray-400 uppercase px-2 mt-4 mb-1 text-xs"
          >
            Schedules & Buses
          </div>
          <a
            href="{% url 'assign_schedule' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            <!-- icon omitted for brevity -->
            Assign Schedule
          </a>
          <a
            href="{% url 'view_bus' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            View Bus
          </a>
          <a
            href="{% url 'today_schedules' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Today's Schedule
          </a>

          <!-- Management (Superuser only) -->
          {% if request.user.is_superuser %}
          <div
            class="font-semibold text-gray-400 uppercase px-2 mt-4 mb-1 text-xs"
          >
            Management
          </div>
          <a
            href="{% url 'trip_reports' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Trip Reports
          </a>
          <a
            href="{% url 'manage_drivers_buses' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Buses & Drivers
          </a>
          <a
            href="{% url 'route_management' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Route Management
          </a>
          <a
            href="{% url 'add_notice' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Notice Management
          </a>
          {% endif %}

          <!-- Reports -->
          {% if request.user.is_superuser %}
          <div
            class="font-semibold text-gray-400 uppercase px-2 mt-4 mb-1 text-xs"
          >
            Reports
          </div>
          <a
            href="{% url 'student_reports' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Student Reports
          </a>
          {% endif %}

          <!-- Support -->
          <div
            class="font-semibold text-gray-400 uppercase px-2 mt-4 mb-1 text-xs"
          >
            Support
          </div>
          <a
            href="{% url 'admin_support_tickets' %}"
            class="px-4 py-2 rounded hover:bg-slate-800 flex items-center gap-2"
          >
            Support Tickets
          </a>

          <!-- Divider & Logout -->
          <hr class="my-4 border-slate-700" />
          <a
            href="{% url 'logout' %}"
            class="mt-3 bg-red-500 hover:bg-red-600 px-4 py-2 rounded text-center text-sm flex items-center gap-2 justify-center"
          >
            Logout
          </a>
        </nav>
      </aside>

      <div
        class="fixed inset-0 bg-black bg-opacity-40 z-20 lg:hidden"
        x-show="sidebarOpen"
        @click="sidebarOpen = false"
      ></div>

      <div class="flex-1 flex flex-col transition-all duration-300">
        <header
          class="bg-white shadow px-4 py-3 lg:hidden flex items-center justify-between"
        >
          <button @click="sidebarOpen = true" class="text-slate-700 text-xl">
            ‚ò∞
          </button>
          <h1 class="text-lg font-semibold">DIU Admin</h1>
        </header>

        {% include "kits/message.html" %}

        <main class="flex-1 p-6 overflow-y-auto">
          {% block content %}{% endblock %}
        </main>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>

    <!-- Secure Google Maps loading without exposing API key -->
    <script src="{% url 'load_google_maps_script' %}" defer></script>

    <script>
      setTimeout(() => {
        const msg = document.getElementById("message-container");
        if (msg) msg.style.display = "none";
      }, 3000);
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
